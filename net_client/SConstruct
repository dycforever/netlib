#!/usr/bin/python
sub = SConscript(['test/SConscript'], variant_dir='build')

env = Environment(CPPPATH = ['.'], CCFLAGS = '-g', tools=['default', 'packaging'])

netlib_sources = [str(fn) for fn in Glob('*.cpp') if str(fn) not in ['main.cpp']]

netlib_files = netlib_sources.append([str(fn) for fn in Glob('*.h')])

env.Library(target = 'netlib',
             source = netlib_sources,
             dirInPackage = 'lib64')
libsname=[
     'netlib',
     'pthread'
]

main = env.Program("main", ["main.cpp"], LIBPATH=["."], LIBS=libsname)

# installation
env.Install("/home/dyc/intall_test/", main)
env.Alias("install", "/home/dyc/intall_test/")

runTests = """
echo "start run test !!!"
#./test/BufferTest
#./test/HttpRequestTest
"""

test = env.Command( target = "test", source = "", action = runTests)
Depends( test, main )
env.AlwaysBuild(test)

#ut = Builder(action = 'echo "running unit test" ')

# print "#############################################################"
# print "installed: ", FindInstalledFiles()
# env.Package( NAME           = 'httpc',
#         VERSION        = '0.0.1',
#         PACKAGEVERSION = 0,
#         PACKAGETYPE    = 'rpm',
#         LICENSE        = 'gpl',
#         SUMMARY        = 'balalalalal',
#         DESCRIPTION    = 'this should be really really long',
#         X_RPM_GROUP    = 'Application/fu', 
#         source = FindInstalledFiles()
#         )
# 

