#!/usr/bin/python

import os
import getpass
user=getpass.getuser()

num_cpu=4
SetOption('num_jobs', num_cpu)
cflags="-g"
libsname=[
     'netlib',
     'z',
     'pthread'
]
if user == "dingyc":
    cflags += " -DSHENMA"
    libsname.append("alog")

# ===========================================

sub = SConscript(['test/SConscript'], variant_dir='build')
env = Environment(CPPPATH = ['.', '/home/dyc/tools/zlib'], CCFLAGS = '-g', tools=['default', 'packaging'])

debug = ARGUMENTS.get('debug', 0)
if int(debug):
        env.Append(CCFLAGS = '-g -DDEBUG_LOG')


netlib_sources = [str(fn) for fn in Glob('*.cpp') if str(fn) not in ['main.cpp']]

netlib_files = netlib_sources.append([str(fn) for fn in Glob('*.h')])

env.Library(target = 'netlib',
             source = netlib_sources,
             dirInPackage = 'lib64')


main = env.Program("main", ["main.cpp"], LINKFLAGS="", LIBPATH=['.', '/home/dyc/tools/zlib'], LIBS=libsname)

# installation
env.Install("/home/dyc/intall_test/", main)
env.Alias("install", "/home/dyc/intall_test/")

runTests = """
echo "start run test !!!"
#./test/BufferTest
#./test/HttpRequestTest
"""

test = env.Command( target = "test", source = "", action = runTests)
Depends( test, main )
env.AlwaysBuild(test)

#ut = Builder(action = 'echo "running unit test" ')

# print "#############################################################"
# print "installed: ", FindInstalledFiles()
# env.Package( NAME           = 'httpc',
#         VERSION        = '0.0.1',
#         PACKAGEVERSION = 0,
#         PACKAGETYPE    = 'rpm',
#         LICENSE        = 'gpl',
#         SUMMARY        = 'balalalalal',
#         DESCRIPTION    = 'this should be really really long',
#         X_RPM_GROUP    = 'Application/fu', 
#         source = FindInstalledFiles()
#         )
# 

